<html>
<head>
<title>Factorization.v</title>
<style>
.time {
  background-color: #ffaaaa;
  height: 100%;
  z-index: -1;
  position: absolute;
}
.code {
  z-index: 0;
  position: relative;
  border-style: solid;
  border-color: transparent;
  border-width: 1px;
}
.code:hover {
  border-style: solid;
  border-color: black;
  border-width: 1px;
}
pre {
  margin: 1px;
}
</style>
</head>
<body>
<h1>Timings for Factorization.v</h1>

<div class="code" title="File: Factorization.v
Line: 1
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>(* -*- mode: coq; mode: visual-line -*- *)

(** * Factorizations and factorization systems. *)

</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 4
Time: 0.046s">
<div class="time" style="width: 10.697674418605%"></div>
<pre>Require Import HoTT.Basics HoTT.Types.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 4
Time: 0.01s">
<div class="time" style="width: 2.3255813953488%"></div>
<pre>
Require Import HProp UnivalenceImpliesFunext Extensions.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 5
Time: 0.001s">
<div class="time" style="width: 0.23255813953488%"></div>
<pre>
Require Import HoTT.Tactics.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 6
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Local Open Scope path_scope.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 7
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>


(** ** Factorizations *)

</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 11
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Section Factorization.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 11
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Universes ctxi.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 12
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  (** It's important that these are all declared with a single [Context] command, so that the marker [@{i}] refers to the same universe level in all of them. *)
 </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 14
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Context {class1 class2 : forall (X Y : Type@{ctxi}), (X -&gt; Y) -&gt; Type@{ctxi}}
          `{forall (X Y : Type@{ctxi}) (g:X-&gt;Y), IsHProp (class1 _ _ g)}
          `{forall (X Y : Type@{ctxi}) (g:X-&gt;Y), IsHProp (class2 _ _ g)}
          {A B : Type@{ctxi}} {f : A -&gt; B}.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 17
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** A factorization of [f] into a first factor lying in [class1] and a second factor lying in [class2]. *)
 </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 20
Time: 0.003s">
<div class="time" style="width: 0.69767441860465%"></div>
<pre>Record Factorization :=
    { intermediate : Type ;
      factor1 : A -&gt; intermediate ;
      factor2 : intermediate -&gt; B ;
      fact_factors : factor2 o factor1 == f ;
      inclass1 : class1 _ _ factor1 ;
      inclass2 : class2 _ _ factor2
    }.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 27
Time: 0.001s">
<div class="time" style="width: 0.23255813953488%"></div>
<pre>

  Lemma issig_Factorization :
    { I : Type &amp; { g : A -&gt; I &amp; { h : I -&gt; B &amp; { p : h o g == f &amp;
      { gin1 : class1 _ _ g &amp; class2 _ _ h }}}}}
      &lt;~&gt; Factorization.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 32
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 33
Time: 0.051s">
<div class="time" style="width: 11.860465116279%"></div>
<pre>
    issig Build_Factorization intermediate factor1 factor2 fact_factors inclass1 inclass2.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 34
Time: 0.033s">
<div class="time" style="width: 7.6744186046512%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 35
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** A path between factorizations is equivalent to a structure of the following sort. *)
 </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 38
Time: 0.008s">
<div class="time" style="width: 1.8604651162791%"></div>
<pre>Record PathFactorization {fact fact' : Factorization} :=
    { path_intermediate : intermediate fact &lt;~&gt; intermediate fact' ;
      path_factor1 : path_intermediate o factor1 fact == factor1 fact' ;
      path_factor2 : factor2 fact == factor2 fact' o path_intermediate ;
      path_fact_factors : forall a, path_factor2 (factor1 fact a)
                          @ ap (factor2 fact') (path_factor1 a)
                          @ fact_factors fact' a
                          = fact_factors fact a
    }.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 46
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** It's easy to extract such a structure from an actual path between factorizations. *)
 </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 49
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition pathfactorization_path (fact fact' : Factorization)
    : (fact = fact') -&gt; @PathFactorization fact fact'.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 50
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 51
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros p.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 52
Time: 0.005s">
<div class="time" style="width: 1.1627906976744%"></div>
<pre>
    simple refine (Build_PathFactorization fact fact' _ _ _ _); destruct p.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 53
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 54
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> exact (equiv_idmap (intermediate fact)).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 54
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 55
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> exact (fun a =&gt; 1).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 55
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 56
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> exact (fun x =&gt; 1).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 56
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 57
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> exact (fun a =&gt; concat_1p _).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 57
Time: 0.002s">
<div class="time" style="width: 0.46511627906977%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 58
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** The converse, however, is more work. In the proof of Theorem 7.6.6, the book glosses over this theorem with the phrase "by univalence and the characterization of paths and transport in Sigma-types, function types, and path types".  Which is arguably fair informally, because it's "obvious", but it turns out to be a good deal of work to keep track of all the transport lemmas and apply naturality in the right places. *)
 </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 61
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Section PathFactorization.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 61
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Context `{Univalence} {fact fact' : Factorization}
            (pf : @PathFactorization fact fact').</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 63
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    (** Let's give short names to the fields of [pf]. *)
   </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 66
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Let II := path_intermediate pf.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 66
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Let ff1 := path_factor1 pf.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 67
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Let ff2 := path_factor2 pf.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 68
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Let fff := path_fact_factors pf.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 69
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    (** Each of those fields now induces a corresponding (dependent) path.  The first one is easy. *)
   </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 72
Time: 0.014s">
<div class="time" style="width: 3.2558139534884%"></div>
<pre>Local Definition II' : intermediate fact = intermediate fact'
      := path_universe II.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 73
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    (** The second is slightly harder, but at least its type is obvious. *)
   </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 76
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Local Definition ff1'
      : transport (fun X =&gt; A -&gt; X) II' (factor1 fact) = factor1 fact'.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 77
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 78
Time: 0.002s">
<div class="time" style="width: 0.46511627906977%"></div>
<pre>
      apply path_arrow; intros a.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 79
Time: 0.001s">
<div class="time" style="width: 0.23255813953488%"></div>
<pre>
      refine (transport_arrow_fromconst (C := idmap) _ _ a @ _).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 80
Time: 0.003s">
<div class="time" style="width: 0.69767441860465%"></div>
<pre>
      etransitivity; [ apply transport_path_universe | ].</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 81
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      apply ff1.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 82
Time: 0.001s">
<div class="time" style="width: 0.23255813953488%"></div>
<pre>
    Defined.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 83
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    (** The type of the third is just like the type of the second, but its proof is a bit more complicated because the type of [ff2] isn't exactly the way it appears naturally here. *)
   </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 86
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Local Definition ff2'
      : transport (fun X =&gt; X -&gt; B) II' (factor2 fact) = factor2 fact'.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 87
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 88
Time: 0.002s">
<div class="time" style="width: 0.46511627906977%"></div>
<pre>
      apply path_arrow; intros a.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 89
Time: 0.001s">
<div class="time" style="width: 0.23255813953488%"></div>
<pre>
      refine (transport_arrow_toconst (B := idmap) _ _ a @ _).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 90
Time: 0.006s">
<div class="time" style="width: 1.3953488372093%"></div>
<pre>
      etransitivity; [ apply ap, transport_path_universe_V | ].</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 91
Time: 0.002s">
<div class="time" style="width: 0.46511627906977%"></div>
<pre>
      etransitivity; [ apply ff2 | ].</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 92
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      apply ap.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 93
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      apply eisretr.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 94
Time: 0.001s">
<div class="time" style="width: 0.23255813953488%"></div>
<pre>
    Defined.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 95
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    (** Finally, even the type of this one is rather intimidating.  It's hard to justify this type until you get to the end of the proof of [path_factorization], below, and see that it's exactly what we need to complete it.  We prove it separately first so that we can make it opaque for performance reasons (roughly a 2x speedup).  Note that we can't make [II'], [ff1'], or [ff2'] opaque, since they have to be unfolded in this proof and the next. *)
   </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 98
Time: 0.018s">
<div class="time" style="width: 4.1860465116279%"></div>
<pre>Local Definition fff' (a : A)
    : (transportD2 (fun X =&gt; A -&gt; X) (fun X =&gt; X -&gt; B)
                   (fun X g h =&gt; {_ : forall a : A, h (g a) = f a &amp;
                                  {_ : class1 A X g &amp; class2 X B h}})
                   II' (factor1 fact) (factor2 fact)
                   (fact_factors fact; (inclass1 fact; inclass2 fact))).1 a =
      ap (transport (fun X =&gt; X -&gt; B) II' (factor2 fact))
        (transport_arrow_fromconst II' (factor1 fact) a
          @ transport_path_universe II (factor1 fact a)
          @ ff1 a)
        @ transport_arrow_toconst II' (factor2 fact) (factor1 fact' a)
        @ ap (factor2 fact) (transport_path_universe_V II (factor1 fact' a))
        @ ff2 (II^-1 (factor1 fact' a))
        @ ap (factor2 fact') (eisretr II (factor1 fact' a))
        @ fact_factors fact' a.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 112
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 113
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      (* The name of the game is looking for naturality properties so that we can apply [fff], so [long_path_scope] is helpful to be able to see the shape of the goal better. *)
     </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 115
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Open Scope long_path_scope.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 115
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      (* Here is a fairly obvious beginning. *)
     </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 117
Time: 0.01s">
<div class="time" style="width: 2.3255813953488%"></div>
<pre>rewrite (ap_transport_arrow_toconst (B := idmap) (C := B)).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 117
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      (* Now we set up for a naturality *)
     </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 119
Time: 0.009s">
<div class="time" style="width: 2.093023255814%"></div>
<pre>rewrite (ap_compose (transport idmap II'^) (factor2 fact)).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 119
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      unfold II'.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 120
Time: 0.116s">
<div class="time" style="width: 26.976744186047%"></div>
<pre>
      rewrite &lt;- ap_p_pp; rewrite_moveL_Mp_p.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 121
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      (* We need to supply [ff2] here or else it will rewrite in the wrong place. *)
     </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 123
Time: 0.008s">
<div class="time" style="width: 1.8604651162791%"></div>
<pre>rewrite (concat_Ap ff2).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 123
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      (* Next is another naturality  *)
     </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 125
Time: 0.008s">
<div class="time" style="width: 1.8604651162791%"></div>
<pre>rewrite ap_compose.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 125
Time: 0.009s">
<div class="time" style="width: 2.093023255814%"></div>
<pre>
      rewrite &lt;- ap_p_pp.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 126
Time: 0.036s">
<div class="time" style="width: 8.3720930232558%"></div>
<pre>
      repeat rewrite (ap_pp (transport idmap (path_universe II)^)).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 127
Time: 0.014s">
<div class="time" style="width: 3.2558139534884%"></div>
<pre>
      rewrite concat_pA_p.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 128
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      (* And another one *)
     </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 130
Time: 0.042s">
<div class="time" style="width: 9.7674418604651%"></div>
<pre>repeat rewrite (ap_pp II).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 130
Time: 0.013s">
<div class="time" style="width: 3.0232558139535%"></div>
<pre>
      rewrite &lt;- (ap_compose (II^-1) II).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 131
Time: 0.012s">
<div class="time" style="width: 2.7906976744186%"></div>
<pre>
      rewrite (concat_pA1_p (eisretr II) (ff1 a)).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 132
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      (* Now we use the triangle identity of our equivalence [II]. *)
     </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 134
Time: 0.011s">
<div class="time" style="width: 2.5581395348837%"></div>
<pre>rewrite (ap_pp (factor2 fact')).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 134
Time: 0.01s">
<div class="time" style="width: 2.3255813953488%"></div>
<pre>
      rewrite eisadj.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 135
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      (* And one more naturality *)
     </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 137
Time: 0.03s">
<div class="time" style="width: 6.9767441860465%"></div>
<pre>repeat rewrite concat_p_pp.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 137
Time: 0.054s">
<div class="time" style="width: 12.558139534884%"></div>
<pre>
      repeat rewrite &lt;- ap_pp.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 138
Time: 0.009s">
<div class="time" style="width: 2.093023255814%"></div>
<pre>
      rewrite &lt;- ap_compose.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 139
Time: 0.009s">
<div class="time" style="width: 2.093023255814%"></div>
<pre>
      rewrite &lt;- (concat_Ap ff2).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 140
Time: 0.075s">
<div class="time" style="width: 17.441860465116%"></div>
<pre>
      rewrite_moveL_Mp_p.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 141
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      (* Finally we can use [fff]! *)
     </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 143
Time: 0.001s">
<div class="time" style="width: 0.23255813953488%"></div>
<pre>refine (_ @ (fff a)^).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 143
Time: 0.085s">
<div class="time" style="width: 19.767441860465%"></div>
<pre>
      do 2 rewrite_moveR_Vp_p.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 144
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      (* Now we still have a mess, but with a little futzing we can put it into a form that we can do path induction over.  The point is to make it all a function of [path_universe II].  In particular, we need to eliminate [eissect II], which we do with [transport_path_universe_Vp]. *)
     </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 146
Time: 0.01s">
<div class="time" style="width: 2.3255813953488%"></div>
<pre>rewrite (ap_pp (transport idmap (path_universe II)^)).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 146
Time: 0.08s">
<div class="time" style="width: 18.604651162791%"></div>
<pre>
      with_rassoc ltac:(rewrite (ap_pp (factor2 fact))).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 147
Time: 0.012s">
<div class="time" style="width: 2.7906976744186%"></div>
<pre>
      unfold II'; rewrite transport_path_universe_Vp.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 148
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      (* This mess is completely general in [path_universe II]! *)
     </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 150
Time: 0.003s">
<div class="time" style="width: 0.69767441860465%"></div>
<pre>fold II.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 150
Time: 0.017s">
<div class="time" style="width: 3.953488372093%"></div>
<pre> set (p := path_universe II); clearbody p.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 150
Time: 0.003s">
<div class="time" style="width: 0.69767441860465%"></div>
<pre>
      case p; cbn.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 151
Time: 0.002s">
<div class="time" style="width: 0.46511627906977%"></div>
<pre> auto with path_hints.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 151
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      Close Scope long_path_scope.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 152
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre></pre>
</div>
<div class="code" title="File: Factorization.v
Line: 152
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      (* Here is a fairly obvious beginning. *)
      rewrite (ap_transport_arrow_toconst (B := idmap) (C := B)).
      (* Now we set up for a naturality *)
      rewrite (ap_compose (transport idmap II'^) (factor2 fact)).
      unfold II'.
      rewrite &lt;- ap_p_pp; rewrite_moveL_Mp_p.
      (* We need to supply [ff2] here or else it will rewrite in the wrong place. *)
      rewrite (concat_Ap ff2).
      (* Next is another naturality  *)
      rewrite ap_compose.
      rewrite &lt;- ap_p_pp.
      repeat rewrite (ap_pp (transport idmap (path_universe II)^)).
      rewrite concat_pA_p.
      (* And another one *)
      repeat rewrite (ap_pp II).
      rewrite &lt;- (ap_compose (II^-1) II).
      rewrite (concat_pA1_p (eisretr II) (ff1 a)).
      (* Now we use the triangle identity of our equivalence [II]. *)
      rewrite (ap_pp (factor2 fact')).
      rewrite eisadj.
      (* And one more naturality *)
      repeat rewrite concat_p_pp.
      repeat rewrite &lt;- ap_pp.
      rewrite &lt;- ap_compose.
      rewrite &lt;- (concat_Ap ff2).
      rewrite_moveL_Mp_p.
      (* Finally we can use [fff]! *)
      refine (_ @ (fff a)^).
      do 2 rewrite_moveR_Vp_p.
      (* Now we still have a mess, but with a little futzing we can put it into a form that we can do path induction over.  The point is to make it all a function of [path_universe II].  In particular, we need to eliminate [eissect II], which we do with [transport_path_universe_Vp]. *)
      rewrite (ap_pp (transport idmap (path_universe II)^)).
      with_rassoc ltac:(rewrite (ap_pp (factor2 fact))).
      unfold II'; rewrite transport_path_universe_Vp.
      (* This mess is completely general in [path_universe II]! *)
      fold II. set (p := path_universe II); clearbody p.
      case p; cbn. auto with path_hints.
     </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 189
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Close Scope long_path_scope.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 189
Time: 0.43s">
<div class="time" style="width: 100%"></div>
<pre>
    Qed.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 190
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    (** Finally, we're ready to prove the main theorem. *)
   </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 193
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition path_factorization : fact = fact'.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 193
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 194
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      (* The idea is of course to decompose [Factorization] as a sigma and use [path_sigma] over and over again.  It's fairly easy to insert [II], [ff1], and [ff2] in the right places. *)
     </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 196
Time: 0.055s">
<div class="time" style="width: 12.790697674419%"></div>
<pre>apply ((ap issig_Factorization^-1)^-1); cbn.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 196
Time: 0.001s">
<div class="time" style="width: 0.23255813953488%"></div>
<pre>
      refine (path_sigma' _ II' _); cbn.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 197
Time: 0.003s">
<div class="time" style="width: 0.69767441860465%"></div>
<pre>
      refine (transport_sigma_' _ _ @ _); cbn.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 198
Time: 0.001s">
<div class="time" style="width: 0.23255813953488%"></div>
<pre>
      refine (path_sigma' _ ff1' _); cbn.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 199
Time: 0.002s">
<div class="time" style="width: 0.46511627906977%"></div>
<pre>
      refine (transport_sigma' _ _ @ _); cbn.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 200
Time: 0.001s">
<div class="time" style="width: 0.23255813953488%"></div>
<pre>
      refine (path_sigma' _ ff2' _); cbn.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 201
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      (* Now we have a gigantic mess, but fortunately it simplifies a great deal because the last two components are hprops. *)
     </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 203
Time: 0.005s">
<div class="time" style="width: 1.1627906976744%"></div>
<pre>refine (transport_sigma (A := intermediate fact' -&gt; B)
                              (B := fun g =&gt; g o factor1 fact' == f)
                              _ _ @ _); cbn.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 205
Time: 0.002s">
<div class="time" style="width: 0.46511627906977%"></div>
<pre>
      simple refine (path_sigma' _ _ _); cbn.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 206
Time: 0.016s">
<div class="time" style="width: 3.7209302325581%"></div>
<pre>
      2:apply path_ishprop.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 207
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      (* It's still pretty scary-looking, but we press ahead undaunted, looking for transport redexes and path redexes. *)
     </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 209
Time: 0.002s">
<div class="time" style="width: 0.46511627906977%"></div>
<pre>apply path_forall; intros a.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 209
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      unfold pointwise_paths.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 210
Time: 0.008s">
<div class="time" style="width: 1.8604651162791%"></div>
<pre>
      rewrite transport_forall_constant, transport_paths_Fl.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 211
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      unfold II', ff1', ff2'.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 212
Time: 0.013s">
<div class="time" style="width: 3.0232558139535%"></div>
<pre>
      rewrite ap_apply_l, ap10_path_arrow.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 213
Time: 0.013s">
<div class="time" style="width: 3.0232558139535%"></div>
<pre>
      rewrite transport_sigma_'; cbn.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 214
Time: 0.016s">
<div class="time" style="width: 3.7209302325581%"></div>
<pre>
      rewrite transport_forall_constant, transport_paths_Fl.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 215
Time: 0.01s">
<div class="time" style="width: 2.3255813953488%"></div>
<pre>
      rewrite (ap_compose (fun g:A-&gt;intermediate fact' =&gt; g a)
                          (fun x =&gt; transport (fun X =&gt; X -&gt; B) (path_universe II)
                                              (factor2 fact) x)).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 218
Time: 0.015s">
<div class="time" style="width: 3.4883720930233%"></div>
<pre>
      rewrite ap_apply_l, ap10_path_arrow.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 219
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      (* Finally we can apply our monster lemma [fff']. *)
     </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 221
Time: 0.054s">
<div class="time" style="width: 12.558139534884%"></div>
<pre>do 2 apply moveR_Vp; repeat rewrite concat_p_pp.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 221
Time: 0.001s">
<div class="time" style="width: 0.23255813953488%"></div>
<pre>
      exact (fff' a).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 222
Time: 0.408s">
<div class="time" style="width: 94.883720930233%"></div>
<pre>
    Qed.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 223
Time: 0.062s">
<div class="time" style="width: 14.418604651163%"></div>
<pre>

  End PathFactorization.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 225
Time: 0.38s">
<div class="time" style="width: 88.372093023256%"></div>
<pre>
End Factorization.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 226
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Arguments Factorization class1 class2 {A B} f.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 228
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Arguments PathFactorization {class1 class2 A B f} fact fact'.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 229
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(* This enables us to talk about "the image of a map" as a factorization but also as the intermediate object appearing in it, as is common in informal mathematics. *)</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 231
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Coercion intermediate : Factorization &gt;-&gt; Sortclass.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 231
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** ** Factorization Systems *)

(** A ("unique" or "orthogonal") factorization system consists of a couple of classes of maps, closed under composition, such that every map admits a unique factorization. *)</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 235
Time: 0.008s">
<div class="time" style="width: 1.8604651162791%"></div>
<pre>Record FactorizationSystem@{i j k} :=
  { class1 : forall {X Y : Type@{i}}, (X -&gt; Y) -&gt; Type@{j} ;
    ishprop_class1 : forall {X Y : Type@{i}} (g:X-&gt;Y), IsHProp (class1 g) ;
    class1_isequiv : forall {X Y : Type@{i}} (g:X-&gt;Y) {geq:IsEquiv g}, class1 g ;
    class1_compose : forall {X Y Z : Type@{i}} (g:X-&gt;Y) (h:Y-&gt;Z),
                       class1 g -&gt; class1 h -&gt; class1 (h o g) ;
    class2 : forall {X Y : Type@{i}}, (X -&gt; Y) -&gt; Type@{k} ;
    ishprop_class2 : forall {X Y : Type@{i}} (g:X-&gt;Y), IsHProp (class2 g) ;
    class2_isequiv : forall {X Y : Type@{i}} (g:X-&gt;Y) {geq:IsEquiv g}, class2 g ;
    class2_compose : forall {X Y Z : Type@{i}} (g:X-&gt;Y) (h:Y-&gt;Z),
                       class2 g -&gt; class2 h -&gt; class2 (h o g) ;
    (** Morally, the uniqueness of factorizations says that [Factorization class1 class2 f] is contractible.  However, in practice we always *prove* that by way of [path_factorization], and we frequently want to *use* the components of a [PathFactorization] as well.  Thus, as data we store the canonical factorization and a [PathFactorization] between any two such, and prove in a moment that this implies contractibility of the space of factorizations. *)
    factor : forall {X Y : Type@{i}} (f:X-&gt;Y), Factorization@{i i} (@class1) (@class2) f ;
    path_factor : forall {X Y : Type@{i}} (f:X-&gt;Y)
                         (fact : Factorization@{i i} (@class1) (@class2) f)
                         (fact' : Factorization@{i i} (@class1) (@class2) f),
                    PathFactorization@{i i i} fact fact'
  }.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 252
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Global Existing Instances ishprop_class1 ishprop_class2.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 254
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Section FactSys.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 256
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Context `{Univalence} (factsys : FactorizationSystem).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 258
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Definition Build_Factorization' {X Y}
    := @Build_Factorization (@class1 factsys) (@class2 factsys) X Y.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 261
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Definition Build_PathFactorization' {X Y}
    := @Build_PathFactorization (@class1 factsys) (@class2 factsys) X Y.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 264
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** The type of factorizations is, as promised, contractible. *)
 </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 267
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Theorem contr_factor {X Y} (f : X -&gt; Y)
  : Contr (Factorization (@class1 factsys) (@class2 factsys) f).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 268
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 269
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply contr_inhabited_hprop.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 270
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 271
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> apply hprop_allpath.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 271
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      intros fact fact'.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 272
Time: 0.015s">
<div class="time" style="width: 3.4883720930233%"></div>
<pre>
      apply path_factorization; try exact _.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 273
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      apply path_factor.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 274
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 275
Time: 0.005s">
<div class="time" style="width: 1.1627906976744%"></div>
<pre> apply factor.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 275
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 276
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** It follows that the left class is right-cancellable and the right class is left-cancellable. *)
 </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 279
Time: 0.001s">
<div class="time" style="width: 0.23255813953488%"></div>
<pre>Definition cancelR_class1 {X Y Z} (f : X -&gt; Y) (g : Y -&gt; Z)
  : class1 factsys f -&gt; class1 factsys (g o f) -&gt; class1 factsys g.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 280
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 281
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros c1f c1gf.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 282
Time: 0.001s">
<div class="time" style="width: 0.23255813953488%"></div>
<pre>
    destruct (factor factsys g) as [I g1 g2 gf c1g1 c2g2].</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 283
Time: 0.002s">
<div class="time" style="width: 0.46511627906977%"></div>
<pre>
    pose (fact  := Build_Factorization' (g o f) Z (g o f) (idmap)
                     (fun x =&gt; 1) c1gf (class2_isequiv factsys idmap)).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 285
Time: 0.001s">
<div class="time" style="width: 0.23255813953488%"></div>
<pre>
    pose (fact' := Build_Factorization' (g o f) I (g1 o f) g2
                     (fun x =&gt; gf (f x))
                     (class1_compose factsys f g1 c1f c1g1) c2g2).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 288
Time: 0.005s">
<div class="time" style="width: 1.1627906976744%"></div>
<pre>
    destruct (path_factor factsys (g o f) fact fact')
             as [q q1 q2 qf]; simpl in *.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 290
Time: 0.002s">
<div class="time" style="width: 0.46511627906977%"></div>
<pre>
    refine (transport (class1 factsys) (path_arrow _ _ gf) _).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 291
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    refine (class1_compose factsys g1 g2 c1g1 _).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 292
Time: 0.007s">
<div class="time" style="width: 1.6279069767442%"></div>
<pre>
    refine (transport (class1 factsys) (path_arrow q^-1 g2 _)
                      (class1_isequiv factsys q^-1)).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 294
Time: 0.003s">
<div class="time" style="width: 0.69767441860465%"></div>
<pre>
    unfold pointwise_paths; equiv_intro q x.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 295
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    exact (eissect q x @ q2 x).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 296
Time: 0.002s">
<div class="time" style="width: 0.46511627906977%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 297
Time: 0.001s">
<div class="time" style="width: 0.23255813953488%"></div>
<pre>

  Definition cancelL_class2 {X Y Z} (f : X -&gt; Y) (g : Y -&gt; Z)
  : class2 factsys g -&gt; class2 factsys (g o f) -&gt; class2 factsys f.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 300
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 301
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros c2g c2gf.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 302
Time: 0.001s">
<div class="time" style="width: 0.23255813953488%"></div>
<pre>
    destruct (factor factsys f) as [I f1 f2 ff c1f1 c2f2].</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 303
Time: 0.002s">
<div class="time" style="width: 0.46511627906977%"></div>
<pre>
    pose (fact  := Build_Factorization' (g o f) X (idmap) (g o f)
                     (fun x =&gt; 1) (class1_isequiv factsys idmap) c2gf).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 305
Time: 0.002s">
<div class="time" style="width: 0.46511627906977%"></div>
<pre>
    pose (fact' := Build_Factorization' (g o f) I f1 (g o f2)
                     (fun x =&gt; ap g (ff x))
                     c1f1 (class2_compose factsys f2 g c2f2 c2g)).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 308
Time: 0.005s">
<div class="time" style="width: 1.1627906976744%"></div>
<pre>
    destruct (path_factor factsys (g o f) fact fact')
             as [q q1 q2 qf]; simpl in *.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 310
Time: 0.003s">
<div class="time" style="width: 0.69767441860465%"></div>
<pre>
    refine (transport (class2 factsys) (path_arrow _ _ ff) _).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 311
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    refine (class2_compose factsys f1 f2 _ c2f2).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 312
Time: 0.006s">
<div class="time" style="width: 1.3953488372093%"></div>
<pre>
    exact (transport (class2 factsys) (path_arrow q f1 q1)
                     (class2_isequiv factsys q)).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 314
Time: 0.002s">
<div class="time" style="width: 0.46511627906977%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 315
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** The two classes of maps are automatically orthogonal, i.e. any commutative square from a [class1] map to a [class2] map has a unique diagonal filler.  For now, we only bother to define the lift; in principle we ought to show that the type of lifts is contractible. *)
 </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 318
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Universe ctxi.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 318
Time: 0.003s">
<div class="time" style="width: 0.69767441860465%"></div>
<pre>
  Context {A B X Y : Type@{ctxi}}
          (i : A -&gt; B) (c1i : class1 factsys i)
          (p : X -&gt; Y) (c2p : class2 factsys p)
          (f : A -&gt; X) (g : B -&gt; Y) (h : p o f == g o i).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 322
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** First we factor [f] *)
 </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 325
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Let C  : Type         := intermediate (factor factsys f).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 325
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Let f1 : A -&gt; C       := factor1      (factor factsys f).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 326
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Let f2 : C -&gt; X       := factor2      (factor factsys f).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 327
Time: 0.001s">
<div class="time" style="width: 0.23255813953488%"></div>
<pre>
  Let ff : f2 o f1 == f := fact_factors (factor factsys f).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 328
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** and [g] *)
 </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 331
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Let D  : Type         := intermediate (factor factsys g).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 331
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Let g1 : B -&gt; D       := factor1      (factor factsys g).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 332
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Let g2 : D -&gt; Y       := factor2      (factor factsys g).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 333
Time: 0.001s">
<div class="time" style="width: 0.23255813953488%"></div>
<pre>
  Let gf : g2 o g1 == g := fact_factors (factor factsys g).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 334
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Now we observe that [p o f2] and [f1], and [g2] and [g1 o i], are both factorizations of the common diagonal of the commutative square (for which we use [p o f], but we could equally well use [g o i]. *)
 </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 337
Time: 0.005s">
<div class="time" style="width: 1.1627906976744%"></div>
<pre>Let fact  : Factorization (@class1 factsys) (@class2 factsys) (p o f)
            := Build_Factorization' (p o f) C f1 (p o f2)
                 (fun a =&gt; ap p (ff a))
                 (inclass1 (factor factsys f))
                 (class2_compose factsys f2 p
                                 (inclass2 (factor factsys f))
                                 c2p).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 343
Time: 0.006s">
<div class="time" style="width: 1.3953488372093%"></div>
<pre>
  Let fact' : Factorization (@class1 factsys) (@class2 factsys) (p o f)
            := Build_Factorization' (p o f) D (g1 o i) g2
                 (fun a =&gt; gf (i a) @ (h a)^)
                 (class1_compose factsys i g1 c1i
                                 (inclass1 (factor factsys g)))
                 (inclass2 (factor factsys g)).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 349
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Therefore, by the uniqueness of factorizations, we have an equivalence [q] relating them. *)
 </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 352
Time: 0.002s">
<div class="time" style="width: 0.46511627906977%"></div>
<pre>Let q  : C &lt;~&gt; D          := path_intermediate
                                 (path_factor factsys (p o f) fact fact').</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 353
Time: 0.004s">
<div class="time" style="width: 0.93023255813953%"></div>
<pre>
  Let q1 : q o f1 == g1 o i := path_factor1
                                 (path_factor factsys (p o f) fact fact').</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 355
Time: 0.004s">
<div class="time" style="width: 0.93023255813953%"></div>
<pre>
  Let q2 : p o f2 == g2 o q := path_factor2
                                 (path_factor factsys (p o f) fact fact').</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 357
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Using this, we can define the lift. *)
 </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 360
Time: 0.007s">
<div class="time" style="width: 1.6279069767442%"></div>
<pre>Definition lift_factsys : B -&gt; X
    := f2 o q^-1 o g1.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 361
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** And the commutative triangles making it a lift *)
 </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 364
Time: 0.001s">
<div class="time" style="width: 0.23255813953488%"></div>
<pre>Definition lift_factsys_tri1 : lift_factsys o i == f.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 364
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 365
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros x.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 366
Time: 0.002s">
<div class="time" style="width: 0.46511627906977%"></div>
<pre>
    refine (ap (f2 o q^-1) (q1 x)^ @ _).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 367
Time: 0.004s">
<div class="time" style="width: 0.93023255813953%"></div>
<pre>
    transitivity (f2 (f1 x)).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 368
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    +</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 369
Time: 0.001s">
<div class="time" style="width: 0.23255813953488%"></div>
<pre> apply ap, eissect.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 369
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    +</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 370
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> apply ff.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 370
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 371
Time: 0.001s">
<div class="time" style="width: 0.23255813953488%"></div>
<pre>

  Definition lift_factsys_tri2 : p o lift_factsys == g.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 373
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 374
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros x.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 375
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    refine (q2 _ @ _).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 376
Time: 0.004s">
<div class="time" style="width: 0.93023255813953%"></div>
<pre>
    transitivity (g2 (g1 x)).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 377
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    +</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 378
Time: 0.001s">
<div class="time" style="width: 0.23255813953488%"></div>
<pre> apply ap, eisretr.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 378
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    +</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 379
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> apply gf.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 379
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 380
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** And finally prove that these two triangles compose to the given commutative square. *)
 </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 383
Time: 0.001s">
<div class="time" style="width: 0.23255813953488%"></div>
<pre>Definition lift_factsys_square (x : A)
  : ap p (lift_factsys_tri1 x)^ @ lift_factsys_tri2 (i x) = h x.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 384
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 385
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    unfold lift_factsys_tri1, lift_factsys_tri2.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 386
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Open Scope long_path_scope.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 387
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    (* First we use the one aspect of the uniqueness of factorizations that we haven't mentioned yet. *)
   </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 389
Time: 0.004s">
<div class="time" style="width: 0.93023255813953%"></div>
<pre>pose (r := path_fact_factors (path_factor factsys (p o f) fact fact') x
            : q2 (f1 x) @ ap g2 (q1 x) @ (gf (i x) @ (h x)^) = ap p (ff x)).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 390
Time: 0.002s">
<div class="time" style="width: 0.46511627906977%"></div>
<pre>
    rewrite concat_p_pp in r.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 391
Time: 0.007s">
<div class="time" style="width: 1.6279069767442%"></div>
<pre>
    apply moveL_pM, moveR_Vp in r.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 392
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    refine (_ @ r); clear r.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 393
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    (* Now we can cancel some whiskered paths on both sides. *)
   </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 395
Time: 0.029s">
<div class="time" style="width: 6.7441860465116%"></div>
<pre>repeat rewrite inv_pp; repeat rewrite ap_pp; rewrite ap_V.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 395
Time: 0.027s">
<div class="time" style="width: 6.2790697674419%"></div>
<pre>
    repeat rewrite concat_pp_p; apply whiskerL.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 396
Time: 0.027s">
<div class="time" style="width: 6.2790697674419%"></div>
<pre>
    repeat rewrite concat_p_pp; apply whiskerR.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 397
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    (* Next we set up for a naturality. *)
   </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 399
Time: 0.013s">
<div class="time" style="width: 3.0232558139535%"></div>
<pre>rewrite (ap_compose q^-1 f2), &lt;- ap_pp, &lt;- inv_pp.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 399
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    (* The next line appears to do nothing, but in fact it is necessary for the subsequent [rewrite] to succeed, because [lift_factsys] appears in the invisible implicit point-arguments of [paths].  One way to discover issues of that sort is to turn on printing of all implicit argumnets with [Set Printing All]; another is to use [Set Debug Tactic Unification] and inspect the output to see what [rewrite] is trying and failing to unify. *)
   </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 401
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>unfold lift_factsys.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 401
Time: 0.003s">
<div class="time" style="width: 0.69767441860465%"></div>
<pre>
    rewrite &lt;- ap_pp.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 402
Time: 0.007s">
<div class="time" style="width: 1.6279069767442%"></div>
<pre>
    rewrite &lt;- ap_V, &lt;- ap_compose.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 403
Time: 0.004s">
<div class="time" style="width: 0.93023255813953%"></div>
<pre>
    rewrite (concat_Ap q2).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 404
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    (* Now we can cancel another path *)
   </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 406
Time: 0.004s">
<div class="time" style="width: 0.93023255813953%"></div>
<pre>rewrite concat_pp_p; apply whiskerL.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 406
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    (* And set up for an application of [ap]. *)
   </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 408
Time: 0.003s">
<div class="time" style="width: 0.69767441860465%"></div>
<pre>rewrite ap_compose.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 408
Time: 0.003s">
<div class="time" style="width: 0.69767441860465%"></div>
<pre>
    rewrite &lt;- ap_pp.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 409
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply ap.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 410
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    (* Now we apply the triangle identity [eisadj]. *)
   </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 412
Time: 0.008s">
<div class="time" style="width: 1.8604651162791%"></div>
<pre>rewrite inv_pp, ap_pp, ap_V.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 412
Time: 0.002s">
<div class="time" style="width: 0.46511627906977%"></div>
<pre>
    rewrite &lt;- eisadj.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 413
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    (* Finally, we rearrange and it becomes a naturality square. *)
   </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 415
Time: 0.004s">
<div class="time" style="width: 0.93023255813953%"></div>
<pre>rewrite concat_pp_p; apply moveR_Vp.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 415
Time: 0.007s">
<div class="time" style="width: 1.6279069767442%"></div>
<pre>
    rewrite &lt;- ap_V, inv_V, &lt;- ap_compose.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 416
Time: 0.001s">
<div class="time" style="width: 0.23255813953488%"></div>
<pre>
    exact (concat_A1p (eisretr q) (q1 x)).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 417
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Close Scope long_path_scope.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 418
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre></pre>
</div>
<div class="code" title="File: Factorization.v
Line: 418
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    (* First we use the one aspect of the uniqueness of factorizations that we haven't mentioned yet. *)
    pose (r := path_fact_factors (path_factor factsys (p o f) fact fact') x
            : q2 (f1 x) @ ap g2 (q1 x) @ (gf (i x) @ (h x)^) = ap p (ff x)).
    rewrite concat_p_pp in r.
    apply moveL_pM, moveR_Vp in r.
    refine (_ @ r); clear r.
    (* Now we can cancel some whiskered paths on both sides. *)
    repeat rewrite inv_pp; repeat rewrite ap_pp; rewrite ap_V.
    repeat rewrite concat_pp_p; apply whiskerL.
    repeat rewrite concat_p_pp; apply whiskerR.
    (* Next we set up for a naturality. *)
    rewrite (ap_compose q^-1 f2), &lt;- ap_pp, &lt;- inv_pp.
    (* The next line appears to do nothing, but in fact it is necessary for the subsequent [rewrite] to succeed, because [lift_factsys] appears in the invisible implicit point-arguments of [paths].  One way to discover issues of that sort is to turn on printing of all implicit argumnets with [Set Printing All]; another is to use [Set Debug Tactic Unification] and inspect the output to see what [rewrite] is trying and failing to unify. *)
    unfold lift_factsys.
    rewrite &lt;- ap_pp.
    rewrite &lt;- ap_V, &lt;- ap_compose.
    rewrite (concat_Ap q2).
    (* Now we can cancel another path *)
    rewrite concat_pp_p; apply whiskerL.
    (* And set up for an application of [ap]. *)
    rewrite ap_compose.
    rewrite &lt;- ap_pp.
    apply ap.
    (* Now we apply the triangle identity [eisadj]. *)
    rewrite inv_pp, ap_pp, ap_V.
    rewrite &lt;- eisadj.
    (* Finally, we rearrange and it becomes a naturality square. *)
    rewrite concat_pp_p; apply moveR_Vp.
    rewrite &lt;- ap_V, inv_V, &lt;- ap_compose.
    exact (concat_A1p (eisretr q) (q1 x)).
   </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 449
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Close Scope long_path_scope.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 449
Time: 0.062s">
<div class="time" style="width: 14.418604651163%"></div>
<pre>
  Qed.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 450
Time: 0.028s">
<div class="time" style="width: 6.5116279069767%"></div>
<pre>

End FactSys.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 452
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Section FactsysExtensions.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 454
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Context {factsys : FactorizationSystem} {ua : Univalence}.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 455
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** We can deduce the lifting property in terms of extensions fairly easily from the version in terms of commutative squares. *)
 </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 458
Time: 0.001s">
<div class="time" style="width: 0.23255813953488%"></div>
<pre>Definition extension_factsys {A B : Type}
             (f : A -&gt; B) {c1f : class1 factsys f}
             (P : B -&gt; Type) (c2P : class2 factsys (@pr1 B P))
             (d : forall a:A, P (f a))
  : ExtensionAlong f P d.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 462
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 463
Time: 0.001s">
<div class="time" style="width: 0.23255813953488%"></div>
<pre>
    pose (e := lift_factsys factsys f c1f pr1 c2P
                            (fun a =&gt; (f a ; d a)) idmap
                            (fun a =&gt; 1)).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 466
Time: 0.001s">
<div class="time" style="width: 0.23255813953488%"></div>
<pre>
    pose (e2 := lift_factsys_tri2 factsys f c1f pr1 c2P
                            (fun a =&gt; (f a ; d a)) idmap
                            (fun a =&gt; 1)).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 469
Time: 0.001s">
<div class="time" style="width: 0.23255813953488%"></div>
<pre>
    exists (fun a =&gt; (e2 a) # (e a).2).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 470
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros a.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 471
Time: 0.001s">
<div class="time" style="width: 0.23255813953488%"></div>
<pre>
    pose (e1 := lift_factsys_tri1 factsys f c1f pr1 c2P
                            (fun a =&gt; (f a ; d a)) idmap
                            (fun a =&gt; 1) a
                : e (f a) = (f a ; d a)).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 475
Time: 0.006s">
<div class="time" style="width: 1.3953488372093%"></div>
<pre>
    pose (e3 := moveL_M1 _ _ (((ap_V _ _)^ @@ 1)
                @ lift_factsys_square factsys f c1f pr1 c2P
                            (fun a =&gt; (f a ; d a)) idmap
                            (fun a =&gt; 1) a)
                : e2 (f a) = pr1_path e1).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 480
Time: 0.002s">
<div class="time" style="width: 0.46511627906977%"></div>
<pre>
    refine (ap (fun p =&gt; transport P p (e (f a)).2) e3 @ _).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 481
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    exact (pr2_path e1).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 482
Time: 0.01s">
<div class="time" style="width: 2.3255813953488%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 483
Time: 0.005s">
<div class="time" style="width: 1.1627906976744%"></div>
<pre>

End FactsysExtensions.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 486
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

</pre>
</div>
</body>
</html>

